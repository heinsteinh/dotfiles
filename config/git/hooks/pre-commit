#!/bin/sh
# Pre-commit hook for git repositories
# This script runs before each commit to ensure code quality

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "${GREEN}Running pre-commit checks...${NC}"

# Check for debugging statements
echo "Checking for debugging statements..."
if git diff --cached --name-only | xargs grep -l "console.log\|debugger\|pdb.set_trace\|binding.pry" 2>/dev/null; then
    echo "${RED}Error: Debugging statements found. Please remove them before committing.${NC}"
    git diff --cached --name-only | xargs grep -n "console.log\|debugger\|pdb.set_trace\|binding.pry" 2>/dev/null
    exit 1
fi

# Check for TODO/FIXME comments in staged files
echo "Checking for TODO/FIXME comments..."
if git diff --cached --name-only | xargs grep -l "TODO\|FIXME" 2>/dev/null; then
    echo "${YELLOW}Warning: TODO/FIXME comments found:${NC}"
    git diff --cached --name-only | xargs grep -n "TODO\|FIXME" 2>/dev/null
fi

# Check for merge conflict markers
echo "Checking for merge conflict markers..."
if git diff --cached --name-only | xargs grep -l "<<<<<<< HEAD\|=======\|>>>>>>>" 2>/dev/null; then
    echo "${RED}Error: Merge conflict markers found. Please resolve conflicts before committing.${NC}"
    git diff --cached --name-only | xargs grep -n "<<<<<<< HEAD\|=======\|>>>>>>>" 2>/dev/null
    exit 1
fi

# Check for trailing whitespace
echo "Checking for trailing whitespace..."
if git diff --cached --check; then
    echo "${RED}Error: Trailing whitespace found. Please fix before committing.${NC}"
    exit 1
fi

# Run linters if available
if command -v eslint > /dev/null 2>&1; then
    echo "Running ESLint..."
    git diff --cached --name-only --diff-filter=ACM | grep '\.js$\|\.jsx$\|\.ts$\|\.tsx$' | xargs eslint
    if [ $? -ne 0 ]; then
        echo "${RED}ESLint failed. Please fix linting errors before committing.${NC}"
        exit 1
    fi
fi

if command -v flake8 > /dev/null 2>&1; then
    echo "Running flake8..."
    git diff --cached --name-only --diff-filter=ACM | grep '\.py$' | xargs flake8
    if [ $? -ne 0 ]; then
        echo "${RED}flake8 failed. Please fix linting errors before committing.${NC}"
        exit 1
    fi
fi

echo "${GREEN}Pre-commit checks passed!${NC}"
exit 0